# プロジェクトタスクリスト

## 🎯 フェーズ1: 環境準備とツールセットアップ

### Docker環境構築
- [ ] Dockerfileの作成（browsertrix-crawler用）
- [ ] docker-compose.ymlの作成
- [ ] 必要な環境変数の定義（.env.example作成）
- [ ] Makefileの作成（コマンド簡略化用）

### browsertrix-crawler設定
- [ ] browsertrix-crawlerのDockerイメージ選定（最新安定版の確認）
- [ ] 基本設定ファイル（config.yaml）の作成
- [ ] テスト用の最小構成での動作確認

## 🔍 フェーズ2: クロール対象の調査と分析

### サイト構造調査
- [ ] `/blog/`配下のURL構造の調査
- [ ] サイトマップ（sitemap.xml）の存在確認
- [ ] カテゴリ・タグ一覧ページのURL特定
- [ ] 月別アーカイブページのURL特定
- [ ] ページネーションのURL構造の確認
- [ ] 記事総数の概算把握

### リソース依存関係の調査
- [ ] 使用されているCDNの特定（jQuery、FontAwesome等）
- [ ] wp-content/uploads/配下の画像・メディアファイルのパス構造確認
- [ ] CSSファイルの配置場所確認
- [ ] JavaScriptファイルの配置場所確認
- [ ] 外部埋め込みコンテンツ（YouTube、Twitter等）の有無確認

### 除外対象の特定
- [ ] `/wp-admin/`へのリンクの存在確認
- [ ] `/wp-login.php`へのリンクの存在確認
- [ ] `/feed/`、`/xmlrpc.php`等のAPI系URLの確認
- [ ] 検索フォーム・検索結果ページのURL構造確認
- [ ] コメント投稿フォームの動作確認

## 🛠️ フェーズ3: クロール設定の実装

### Seeds（開始点）の設定
- [ ] `/blog/`ルートURLをseedsに追加
- [ ] サイトマップURLをseedsに追加（存在する場合）
- [ ] カテゴリ一覧ページをseedsに追加
- [ ] タグ一覧ページをseedsに追加
- [ ] 月別アーカイブ一覧をseedsに追加
- [ ] 主要な記事（人気記事等）を個別にseedsに追加

### Scope設定
- [ ] scopeType: "prefix"の設定
- [ ] `/blog/`のprefixフィルター設定
- [ ] urlFiltersでの詳細な包含・除外ルール定義
- [ ] 外部CDNの許可リスト作成
- [ ] 除外URLパターンの定義（wp-admin、feed等）

### クロール動作設定
- [ ] pageLoadDelayの最適値決定（レンダリング待機時間）
- [ ] waitUntil設定（networkidle0/networkidle2の選択）
- [ ] スクロール動作の設定（無限スクロール対応）
- [ ] クリック探索の設定（アコーディオン等の展開）
- [ ] タイムアウト値の設定
- [ ] 同時実行数（workers）の設定
- [ ] リトライ設定

### ブラウザ設定
- [ ] User-Agentの設定
- [ ] ビューポートサイズの設定
- [ ] 言語設定（Accept-Language）
- [ ] Cookie設定（必要に応じて）
- [ ] extraHeadersの設定（必要に応じて）

## 🏃 フェーズ4: クロール実行とWACZ生成

### テストクロール
- [ ] 小規模テスト（記事5-10件程度）の実行
- [ ] WARC生成の確認
- [ ] WACZ変換の確認
- [ ] ログ出力の確認
- [ ] エラー・警告の分析

### 本番クロール準備
- [ ] ディスク容量の確認（WARC/WACZ保存用）
- [ ] メモリ・CPU要件の確認
- [ ] クロール時間の見積もり
- [ ] 中断・再開手順の確立

### 本番クロール実行
- [ ] フルクロールの開始
- [ ] 進捗モニタリング
- [ ] エラー監視とトラブルシューティング
- [ ] クロール完了確認
- [ ] WACZファイルの生成確認

### クロール結果の検証
- [ ] 取得URL総数の確認
- [ ] 失敗URL一覧の作成
- [ ] 取得サイズの確認
- [ ] 外部リソース取得状況の確認
- [ ] クロールレポートの生成

## 🎨 フェーズ5: ReplayWeb.page UI実装

### 基本UI構築
- [ ] ReplayWeb.pageライブラリのダウンロード
- [ ] index.htmlの作成
- [ ] 基本的なレイアウト実装
- [ ] WACZファイル読み込み設定
- [ ] Service Workerの設定

### UI カスタマイズ
- [ ] ヘッダー/フッターのデザイン
- [ ] Noteへの導線（リンク/バナー）追加
- [ ] ブランディング要素の追加
- [ ] レスポンシブデザインの確認
- [ ] アクセシビリティの確認

### 機能拡張（オプション）
- [ ] 記事一覧（目次）機能の実装
- [ ] 検索機能の実装（WACZ内検索）
- [ ] お気に入り機能の実装
- [ ] 共有機能の実装

## ☁️ フェーズ6: Cloudflare デプロイ準備

### Cloudflare Pages セットアップ
- [ ] Cloudflare アカウントの準備
- [ ] Pages プロジェクトの作成
- [ ] カスタムドメインの設定（必要に応じて）
- [ ] ビルド設定の構成
- [ ] 環境変数の設定

### ファイルサイズ最適化
- [ ] WACZファイルサイズの確認
- [ ] 25MB制限との比較
- [ ] 必要に応じて分割戦略の検討
- [ ] 圧縮オプションの検討

### R2設定（大容量の場合）
- [ ] R2バケットの作成
- [ ] アクセス権限の設定
- [ ] CORS設定
- [ ] カスタムドメインの設定
- [ ] キャッシュ設定

### リダイレクト設定
- [ ] _redirectsファイルの作成
- [ ] 旧URL → アーカイブUIのマッピング
- [ ] 404ページの設定
- [ ] テストURL一覧の作成

## 🚀 フェーズ7: デプロイと公開

### 初回デプロイ
- [ ] ビルドプロセスの実行
- [ ] Cloudflare Pagesへのアップロード
- [ ] WACZファイルの配置（Pages or R2）
- [ ] Service Worker の動作確認
- [ ] 基本動作確認

### 動作検証
- [ ] トップページの表示確認
- [ ] WACZ読み込みの確認
- [ ] 記事表示の確認（ランダム30件）
- [ ] 画像・メディアの表示確認
- [ ] スタイル（CSS）の適用確認
- [ ] JavaScript動作の確認
- [ ] 内部リンクの動作確認
- [ ] ページネーションの動作確認

### パフォーマンステスト
- [ ] ページロード時間の測定
- [ ] キャッシュ動作の確認
- [ ] オフライン動作の確認
- [ ] モバイル環境での動作確認
- [ ] 低速回線での動作確認

## 📋 フェーズ8: 品質保証と受入テスト

### 受入基準の確認
- [ ] URL網羅性の検証（全記事が含まれているか）
- [ ] 再生品質の検証（30件サンプルチェック）
- [ ] 外部依存の検証（10%未満の確認）
- [ ] 公開状態の確認（Pages上での動作）
- [ ] 再現手順の確認（クリーン環境でのテスト）

### ドキュメント作成
- [ ] README.mdの作成
- [ ] クロール設定ドキュメント
- [ ] デプロイ手順書
- [ ] トラブルシューティングガイド
- [ ] 運用手順書

### 最終レポート作成
- [ ] 取得URL件数の集計
- [ ] 失敗URL一覧とその理由
- [ ] ファイルサイズ統計
- [ ] パフォーマンス測定結果
- [ ] 既知の問題と対処法

## 🔧 フェーズ9: 運用準備

### 監視設定
- [ ] Cloudflare Analytics の設定
- [ ] エラー監視の設定
- [ ] アクセスログの設定
- [ ] アラート設定

### バックアップ
- [ ] WACZファイルのバックアップ
- [ ] 設定ファイルのバックアップ
- [ ] ソースコードのGit管理
- [ ] 復旧手順の文書化

### 更新手順の確立
- [ ] 再クロール手順の自動化
- [ ] デプロイパイプラインの構築
- [ ] バージョン管理戦略
- [ ] ロールバック手順

## 🎯 フェーズ10: カットオーバーと事後対応

### 旧サイト停止準備
- [ ] 停止スケジュールの確定
- [ ] 関係者への通知
- [ ] 最終バックアップ
- [ ] DNSカットオーバー計画

### 公開後の対応
- [ ] 初期監視（24-48時間）
- [ ] ユーザーフィードバックの収集
- [ ] 不具合対応
- [ ] パフォーマンスチューニング

### プロジェクト完了
- [ ] 成果物の最終確認
- [ ] ドキュメントの最終版作成
- [ ] 引き継ぎ資料の作成
- [ ] プロジェクトの振り返り

---

## 📝 補足タスク（必要に応じて実施）

### セキュリティ対策
- [ ] robots.txtの設定
- [ ] noindexメタタグの設定（必要に応じて）
- [ ] アクセス制限の設定（必要に応じて）
- [ ] セキュリティヘッダーの設定

### 法務確認
- [ ] 外部コンテンツの利用規約確認
- [ ] 埋め込みコンテンツの扱い確認
- [ ] プライバシーポリシーの更新
- [ ] 著作権表示の確認

### 追加機能（第2フェーズ）
- [ ] トップページのアーカイブ化検討
- [ ] 固定ページのアーカイブ化検討
- [ ] 他のサブディレクトリの検討
- [ ] 多言語対応の検討