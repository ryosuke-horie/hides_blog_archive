# プロジェクトタスクリスト

## 🎯 フェーズ1: 環境準備とツールセットアップ

### Docker環境構築
- [x] Dockerfileの作成（browsertrix-crawler用）
- [x] docker-compose.ymlの作成
- [x] 必要な環境変数の定義（.env.example作成）
- [x] Makefileの作成（コマンド簡略化用）

### browsertrix-crawler設定
- [x] browsertrix-crawlerのDockerイメージ選定（最新安定版の確認）
- [x] 基本設定ファイル（config.yaml）の作成
- [ ] テスト用の最小構成での動作確認

## 🔍 フェーズ2: クロール対象の調査と分析

### サイト構造調査
- [x] `/blog/`配下のURL構造の調査
- [x] サイトマップ（sitemap.xml）の存在確認
- [x] ページネーションのURL構造の確認
- [x] 記事総数の概算把握

### リソース依存関係の調査
- [x] 使用されているCDNの特定（jQuery、FontAwesome等）
- [x] wp-content/uploads/配下の画像・メディアファイルのパス構造確認
- [x] CSSファイルの配置場所確認
- [x] JavaScriptファイルの配置場所確認
- [x] 外部埋め込みコンテンツ（YouTube、Twitter等）の有無確認

### 除外対象の特定
- [x] `/wp-admin/`へのリンクの存在確認
- [x] `/wp-login.php`へのリンクの存在確認
- [x] `/feed/`、`/xmlrpc.php`等のAPI系URLの確認
- [x] 検索フォーム・検索結果ページのURL構造確認
- [x] コメント投稿フォームの動作確認

## 🛠️ フェーズ3: クロール設定の実装

### Seeds（開始点）の設定
- [x] `/blog/`ルートURLをseedsに追加
- [x] サイトマップURLをseedsに追加（存在する場合）

### Scope設定
- [x] scopeType: "prefix"の設定
- [x] `/blog/`のprefixフィルター設定
- [x] urlFiltersでの詳細な包含・除外ルール定義
- [x] 外部CDNの許可リスト作成
- [x] 除外URLパターンの定義（wp-admin、feed等）

### クロール動作設定
- [x] pageLoadDelayの最適値決定（レンダリング待機時間）
- [x] waitUntil設定（networkidle0/networkidle2の選択）
- [x] スクロール動作の設定（無限スクロール対応）
- [x] クリック探索の設定（アコーディオン等の展開）
- [x] タイムアウト値の設定
- [x] 同時実行数（workers）の設定
- [x] リトライ設定

### ブラウザ設定
- [x] User-Agentの設定
- [x] ビューポートサイズの設定
- [x] 言語設定（Accept-Language）
- [x] Cookie設定（必要に応じて）
- [x] extraHeadersの設定（必要に応じて）

## 🏃 フェーズ4: クロール実行とWACZ生成

### テストクロール
- [x] 小規模テスト（記事5-10件程度）の実行
- [x] WARC生成の確認
- [x] WACZ変換の確認
- [x] ログ出力の確認
- [x] エラー・警告の分析

### 本番クロール準備
- [x] ディスク容量の確認（WARC/WACZ保存用）
- [x] メモリ・CPU要件の確認
- [x] クロール時間の見積もり
- [x] 中断・再開手順の確立

### 本番クロール実行
- [ ] フルクロールの開始
- [ ] 進捗モニタリング
- [ ] エラー監視とトラブルシューティング
- [ ] クロール完了確認
- [ ] WACZファイルの生成確認

### クロール結果の検証
- [ ] 取得URL総数の確認
- [ ] 失敗URL一覧の作成
- [ ] 取得サイズの確認
- [ ] 外部リソース取得状況の確認
- [ ] クロールレポートの生成

## 🎨 フェーズ5: ReplayWeb.page UI実装

### 基本UI構築
- [x] ReplayWeb.pageライブラリのダウンロード
- [x] index.htmlの作成
- [x] 基本的なレイアウト実装
- [x] WACZファイル読み込み設定
- [x] Service Workerの設定

### UI カスタマイズ
- [x] ヘッダー/フッターのデザイン
- [x] Noteへの導線（リンク/バナー）追加
- [x] ブランディング要素の追加
- [x] レスポンシブデザインの確認
- [x] アクセシビリティの確認

### 機能拡張（オプション）
- [ ] 記事一覧（目次）機能の実装
- [ ] 検索機能の実装（WACZ内検索）
- [ ] お気に入り機能の実装
- [ ] 共有機能の実装

## ☁️ フェーズ6: Cloudflare デプロイ準備

### Cloudflare Pages セットアップ
- [x] Pages プロジェクトの作成手順書作成（CLOUDFLARE_DEPLOY.md）
- [ ] 実際のPages プロジェクトの作成
- [ ] カスタムドメインの設定（必要に応じて）
- [ ] ビルド設定の構成
- [ ] 環境変数の設定

### ファイルサイズ最適化
- [ ] WACZファイルサイズの確認
- [ ] 25MB制限との比較
- [ ] 必要に応じて分割戦略の検討
- [ ] 圧縮オプションの検討

### R2設定（大容量の場合）
- [ ] R2バケットの作成
- [ ] アクセス権限の設定
- [ ] CORS設定
- [ ] カスタムドメインの設定
- [ ] キャッシュ設定

## 🚀 フェーズ7: デプロイと公開

### 静的HTMLミラーリング方式（新規追加）
- [x] wgetによるミラーリングスクリプト作成
- [x] テストミラーリング実行（5ページ）
- [ ] 本番ミラーリング実行（全440記事）
- [ ] リンクの相対パス化確認

### 初回デプロイ
- [ ] 静的HTMLファイルの準備
- [ ] Cloudflare Pagesへのアップロード
- [ ] GitHub連携設定（自動デプロイ）
- [ ] カスタムドメイン設定（必要に応じて）
- [ ] 基本動作確認

### 動作検証
- [ ] トップページの表示確認
- [ ] WACZ読み込みの確認
- [ ] 記事表示の確認（ランダム30件）
- [ ] 画像・メディアの表示確認
- [ ] スタイル（CSS）の適用確認
- [ ] JavaScript動作の確認
- [ ] 内部リンクの動作確認
- [ ] ページネーションの動作確認

## 📋 フェーズ8: 品質保証と受入テスト

### 受入基準の確認
- [ ] URL網羅性の検証（全記事が含まれているか）
- [ ] 再生品質の検証（30件サンプルチェック）
- [ ] 外部依存の検証（10%未満の確認）
- [ ] 公開状態の確認（Pages上での動作）
- [ ] 再現手順の確認（クリーン環境でのテスト）

### ドキュメント作成
- [x] README.mdの作成
- [x] クロール設定ドキュメント
- [x] デプロイ手順書（CLOUDFLARE_DEPLOY.md）
- [x] 静的ミラーリングガイド（docs/static_mirror_guide.md）
- [x] トラブルシューティングガイド

### 最終レポート作成
- [ ] 取得URL件数の集計
- [ ] 失敗URL一覧とその理由
- [ ] ファイルサイズ統計
- [ ] 既知の問題と対処法